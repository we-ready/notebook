---
id: 20210206101_redisearch
title: redisearch 101
subtitle: å…¨æ–‡æœç´¢åœ¨å„ç§ web åº”ç”¨ä¸­ï¼Œé€æ¸æˆä¸ºæ ‡é…ã€‚åº”å¯¹å¤§å‹ç³»ç»Ÿï¼ŒES ä¹Ÿè®¸æ›´åŠ é€‚åˆï¼Œè€Œé¢å¯¹ä¸­å°å‹é¡¹ç›®ï¼Œredisearchä¹Ÿè®¸æ˜¯ä¸€ç§æ›´åŠ é€‚åˆçš„æ–¹æ¡ˆã€‚
subject: redisearch
category: æ¦‚å¿µç†è§£
tags: redis;redislabs;redisearch
keywords: å…¨æ–‡æœç´¢;è‡ªåŠ¨è¡¥å…¨;åå‘ç´¢å¼•
level: 100
cover: https://oss.redislabs.com/redisearch/img/logo.svg
author: Chis Wei
created_when: 2021-02-06
updated_when: 2021-02-06
---

# redisearch 101

## å‚è€ƒ

- [gitee mirror of redisearch repo](https://gitee.com/mirrors/redisearch)
- [getting started](https://github.com/RediSearch/redisearch-getting-started)
- [redislabs](https://oss.redislabs.com/redisearch/)
- [RU201: RediSearch](https://university.redislabs.com/courses/ru201/)
- [course material](https://github.com/redislabs-training/ru203/blob/main/README.md)

## RU201: RediSearch

> å¯ä»¥åœ¨ `redislabs university` æ³¨å†Œå¹¶å®Œæˆç›¸å…³è¯¾ç¨‹

### Set Up RediSearch and Loading the Data ï¼ˆæœ¬åœ°ç¯å¢ƒï¼‰

1. å¯åŠ¨è£…æœ‰ `docker compose` çš„ `VMWare CentOS` æœåŠ¡å™¨
2. é€šè¿‡ `XShell` è¿æ¥æœåŠ¡å™¨
3. å¯åŠ¨ `redis` å®ä¾‹ï¼ˆæœåŠ¡å™¨ä¸Šä¹‹å‰æ²¡æœ‰ç›¸å…³é•œåƒï¼Œå¯åŠ¨è¿‡ç¨‹ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…ï¼Œå®‰è£…éœ€è¦ä¸€äº›æ—¶é—´ã€‚ï¼‰

âœ¨ğŸ”¥âš ï¸ğŸ’¯ğŸ’

```
docker run -it --rm --name redis-search-2 -p 6379:6379  redislabs/redisearch:2.0.5
```

4. ä»ä»£ç åº“ä¸‹è½½è¯•éªŒæ•°æ® `commands.redis`ï¼Œå¹¶ä¸Šä¼ åˆ°æœåŠ¡å™¨

```
# rz
```

5. åŠ è½½è¯•éªŒæ•°æ®

âœ¨ğŸ”¥âš ï¸ğŸ’¯ğŸ’

```
docker exec -i redis-search-2 redis-cli < commands.redis > output.txt
```

6. æ£€æŸ¥ `output.txt`

```
grep Invalid output.txt
```

> ç¡®ä¿æ²¡æœ‰ä»»ä½• `invalid` æ•°æ®ã€‚ï¼ˆå¦åˆ™ï¼Œè¯´æ˜ç¯å¢ƒæ²¡æœ‰æ­£ç¡®å®‰è£…ï¼‰

### æŸ¥è¯¢ç»“æ„åŒ–æ•°æ®

#### åŸºæœ¬è¯­æ³•

```
@[field]:{[keyword]}
```

#### è½¬è¯‘å­—ç¬¦

```
\\
```

#### ç»ƒä¹ 

- è¿æ¥ `docker`

âœ¨ğŸ”¥âš ï¸ğŸ’¯ğŸ’

```
docker exec -it redis-search-2 redis-cli
```

- åˆ›å»ºç´¢å¼•

âœ¨ğŸ”¥âš ï¸ğŸ’¯ğŸ’

```
FT.CREATE books-idx ON HASH PREFIX 1 ru203:book:details: SCHEMA isbn TAG SORTABLE title TEXT WEIGHT 2.0 SORTABLE subtitle TEXT SORTABLE thumbnail TAG NOINDEX description TEXT SORTABLE published_year NUMERIC SORTABLE average_rating NUMERIC SORTABLE authors TEXT SORTABLE categories TAG SEPARATOR ";" author_ids TAG SEPARATOR ";"

FT.CREATE users-idx ON HASH PREFIX 1 ru203:user:details: SCHEMA first_name TEXT SORTABLE last_name TEXT SORTABLE email TAG SORTABLE escaped_email TEXT NOSTEM SORTABLE user_id TAG SORTABLE last_login NUMERIC SORTABLE

FT.CREATE authors-idx ON HASH PREFIX 1 ru203:author:details: SCHEMA name TEXT SORTABLE author_id TAG SORTABLE

FT.CREATE authors-books-idx ON HASH PREFIX 1 ru203:author:books: SCHEMA book_isbn TAG SORTABLE author_id TAG SORTABLE

FT.CREATE checkouts-idx ON HASH PREFIX 1 ru203:book:checkout: SCHEMA user_id TAG SORTABLE book_isbn TAG SORTABLE checkout_date NUMERIC SORTABLE return_date NUMERIC SORTABLE checkout_period_days NUMERIC SORTABLE geopoint GEO
```

> æ¯æ¬¡é€€å‡º dockerï¼Œç›¸å…³å‘½ä»¤éœ€è¦é‡æ–°æ‰§è¡Œ

- æŸ¥æ‰¾æ•°æ®ï¼ˆ`String`ç±»å‹ï¼‰

```
FT.SEARCH books-idx "@isbn:{9781577312093}"

FT.SEARCH authors-idx "@author_id:{690}"

FT.SEARCH books-idx "@author_ids:{690}" RETURN 1 title

FT.SEARCH books-idx "@categories:{Fantasy}"
```

> å¯¹äºå­—ç¬¦ä¸²æŸ¥è¯¢ï¼Œæœ€æœ‰æ•ˆçš„æ•°æ®ç±»å‹æ˜¯ `TAG`

- æŸ¥æ‰¾æ•°æ®ï¼ˆ`Number`ç±»å‹ï¼‰

```
FT.SEARCH books-idx "@average_rating:[4.5 5]" RETURN 1 title

FT.SEARCH books-idx "@average_rating:[0 1]" RETURN 1 title

FT.SEARCH books-idx "@average_rating:[4 +inf] @published_year:[2015 +inf]" RETURN 1 title

FT.SEARCH books-idx "@average_rating:[-inf 3] @published_year:[-inf (2000]" RETURN 1 title
```

> `inf` è¡¨ç¤ºæ— ç©·

> `)(` è¡¨ç¤ºä¸åŒ…å«ï¼ˆç¼ºçœæŸ¥è¯¢èŒƒå›´ï¼Œä¼šåŒ…å«ä¸¤ç«¯ï¼‰

- æŸ¥æ‰¾æ•°æ®ï¼ˆ`Date` `Time` ç±»å‹ï¼‰

```
FT.SEARCH users-idx "@last_login:[1607693100 +inf]"

FT.SEARCH users-idx "@last_login:[-inf (1607693100]"
```

âœ¨ğŸ”¥âš ï¸ğŸ’¯ğŸ’
> [A simple converter tool for Unix Timestamps](http://www.unixtimestampconverter.com/)

- æŸ¥æ‰¾æ•°æ®ï¼ˆ`Boolean Logic` ç±»å‹ï¼‰

```
FT.SEARCH books-idx "dogs cats"

FT.SEARCH books-idx "dogs|cats"

FT.SEARCH books-idx "dogs -cats"
```

> `ä¸` `æˆ–` `é`

```
FT.SEARCH books-idx "@title:Meridian | Orchard"

FT.SEARCH books-idx "@authors:rowling @title:goblet"

FT.SEARCH books-idx "@authors:rowling | @title:potter"

FT.SEARCH books-idx "@authors:tolkien -@title:ring"
```

```
FT.SEARCH books-idx "@authors:'Stephen King' @published_year:[1980 1990]"

FT.SEARCH books-idx "@categories:{Philosophy} @published_year:[-inf 1975] -@authors:'Arthur Koestler'"

FT.SEARCH books-idx "@authors:'Arthur Koestler' | @authors:'Michel Foucault'"
```

- æŸ¥è¯¢ç»“æœæ’åºï¼ˆ`Sorting`ï¼‰

> ç›¸å…³å­—æ®µå¿…é¡»æ˜¯ `SORTABLE` çš„

> ä½¿ç”¨ `aggregation` ç‰¹æ€§çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨ä¸€æ¬¡æœç´¢ä¸­å¯¹å¤šä¸ªå­—æ®µè¿›è¡Œæ’åº

```
FT.SEARCH books-idx "@published_year:[2018 +inf]" SORTBY published_year DESC

FT.SEARCH books-idx "@categories:{Juvenile Fiction}" SORTBY published_year

FT.SEARCH books-idx "@average_rating:[4.9 5]" SORTBY average_rating DESC
```

- æŸ¥è¯¢ç»“æœæ•°é‡é™åˆ¶ï¼ˆ`Limiting`ï¼‰

> 2 ä¸ªå‚æ•°ï¼š`offset` `limit`

> `offset` æ˜¯ `0` å¼€å§‹çš„

```
FT.SEARCH books-idx "@authors:Agatha Christie" SORTBY published_year LIMIT 0 5

FT.SEARCH books-idx "@authors:Agatha Christie" SORTBY published_year LIMIT 5 5

FT.SEARCH books-idx "@authors:Ursula K. Le Guin" SORTBY "published_year" LIMIT 0 3

FT.SEARCH books-idx "@published_year:[2000 +inf]" LIMIT 100 100
```

### å…¨æ–‡æœç´¢

#### æ¦‚å¿µ

- æœç´¢ `TEXT` ç±»å‹å­—æ®µ
- `stemming`: `TEXT` ç±»å‹å­—æ®µè¢«ç´¢å¼•æ—¶ï¼Œå•è¯ä¼šè¢«è½¬åŒ–ä¸ºè¯æ ¹

#### ç»ƒä¹ 

```
FT.SEARCH books-idx "@title:running" RETURN 1 title

FT.SEARCH books-idx "John Le Carre"

FT.SEARCH books-idx unicorns
```

#### æ¨¡ç³ŠæŸ¥è¯¢ ï¼ˆ`prefix matching`ï¼‰

> æ¨¡ç³ŠæŸ¥è¯¢ä¼šæ¶ˆè€—æ€§èƒ½

```
FT.SEARCH books-idx "atwood hand*"

FT.SEARCH books-idx "agat* orie*"
```

#### é€»è¾‘ã€æ’åºã€é™åˆ¶

```
FT.SEARCH books-idx "dragons -wizard -magician"

FT.SEARCH books-idx "mars @authors:heinlein"

FT.SEARCH books-idx crypto* sortby published_year

FT.SEARCH books-idx murder sortby published_year limit 0 1
```

#### é«˜äº® æ¦‚è¦

```
FT.SEARCH books-idx illusion highlight

FT.SEARCH books-idx "nurture" HIGHLIGHT FIELDS 2 title subtitle

FT.SEARCH books-idx shield HIGHLIGHT SUMMARIZE FIELDS 1 description FRAGS 1 LEN 20

FT.SEARCH books-idx agamemnon SUMMARIZE FIELDS 1 description FRAGS 3 LEN 25

FT.SEARCH books-idx agamemnon SUMMARIZE FIELDS 1 description FRAGS 3 LEN 25 HIGHLIGHT
```

### èšåˆï¼ˆaggregationï¼‰

#### ç»Ÿè®¡ï¼ˆcountingï¼‰

```
FT.AGGREGATE books-idx * GROUPBY 0 REDUCE COUNT 0 AS total

FT.SEARCH books-idx "@categories:{Fiction}" LIMIT 0 0
```

#### åˆ†ç»„ï¼ˆgroupingï¼‰

```
FT.AGGREGATE books-idx tolkien GROUPBY 0

FT.AGGREGATE checkouts-idx * GROUPBY 1 @checkout_date

FT.AGGREGATE books-idx python GROUPBY 1 @categories

FT.AGGREGATE books-idx marauder GROUPBY 2 @published_year @average_rating
```

#### æ’åºï¼ˆsortingï¼‰

```
FT.AGGREGATE users-idx * GROUPBY 2 @last_login @last_name SORTBY 1 @last_name

FT.AGGREGATE books-idx "@published_year:[1983 1983]" GROUPBY 2 @authors @title SORTBY 2 @authors @title
```

#### èšåˆï¼ˆreducingï¼‰

```
FT.AGGREGATE books-idx * GROUPBY 1 @categories REDUCE COUNT 0 AS books_count SORTBY 2 @books_count DESC

FT.AGGREGATE books-idx tolkien GROUPBY 0 REDUCE AVG 1 @average_rating as avg_rating
```

âœ¨ğŸ”¥âš ï¸ğŸ’¯ğŸ’
> [Ref](https://oss.redislabs.com/redisearch/Aggregations/#supported_groupby_reducers)

#### å˜æ¢ï¼ˆtransformingï¼‰

```
FT.AGGREGATE books-idx * APPLY "split(@authors, ';')" AS authors_split GROUPBY 1 @title REDUCE COUNT 1 authors_split AS num_authors FILTER "@num_authors==2"

FT.AGGREGATE users-idx * GROUPBY 1 @last_login APPLY "dayofweek(@last_login)" AS day_of_week GROUPBY 1 @day_of_week SORTBY 1 @day_of_week

FT.AGGREGATE users-idx * GROUPBY 2 @last_login @user_id APPLY "day(@last_login)" as last_login_day APPLY "timefmt(@last_login_day)" AS "last_login_str" GROUPBY 1 "@last_login_str" REDUCE COUNT_DISTINCT 1 "@user_id" AS num_logins FILTER "@num_logins>1"
```

### è¿›é˜¶åŠŸèƒ½

#### Patial Index

```
FT.CREATE books-older-idx ON HASH PREFIX 1 ru203:book:details: FILTER "@published_year<1990" SCHEMA isbn TAG SORTABLE title TEXT WEIGHT 2.0 SORTABLE subtitle TEXT SORTABLE thumbnail TAG NOINDEX description TEXT SORTABLE published_year NUMERIC SORTABLE average_rating NUMERIC SORTABLE authors TEXT SORTABLE categories TAG SEPARATOR ";" author_ids TAG SEPARATOR ";"

FT.CREATE books-newer-idx ON HASH PREFIX 1 ru203:book:details: FILTER "@published_year>=1990" SCHEMA isbn TAG SORTABLE title TEXT WEIGHT 2.0 SORTABLE subtitle TEXT SORTABLE thumbnail TAG NOINDEX description TEXT SORTABLE published_year NUMERIC SORTABLE average_rating NUMERIC SORTABLE authors TEXT SORTABLE categories TAG SEPARATOR ";" author_ids TAG SEPARATOR ";"
```

```
FT.SEARCH books-older-idx * LIMIT 0 0

FT.SEARCH books-newer-idx * LIMIT 0 0
```

```
FT.CREATE books-fiction-idx ON HASH PREFIX 1 ru203:book:details: FILTER "@categories=='Fiction'" SCHEMA isbn TAG SORTABLE title TEXT WEIGHT 2.0 SORTABLE subtitle TEXT SORTABLE thumbnail TAG NOINDEX description TEXT SORTABLE published_year NUMERIC SORTABLE average_rating NUMERIC SORTABLE authors TEXT SORTABLE categories TAG SEPARATOR ";" author_ids TAG SEPARATOR ";"

FT.AGGREGATE books-fiction-idx * GROUPBY 1 @authors REDUCE COUNT_DISTINCT 1 @title as total_books SORTBY 2 @total_books DESC
```


#### WEIGHT (æƒé‡)

```
FT.SEARCH books-idx "((@categories:{History}) => { $weight: 10 } greek) | greek"

FT.SEARCH books-idx "((@published_year:[2000 +inf]) => { $weight: 10 } cowboy) | cowboy"
```

#### Getting All

```
FT.SEARCH users-idx *
```

> `*`

#### Exact-Matching Punctuation (ç²¾ç¡®åŒ¹é…)

```
HMSET ru203:user:details:28 first_name "Kelvin" last_name "Brown" email "k.brown@example.com" escaped_email "k\\.brown\\@example\\.com" user_id "28"

FT.SEARCH users-idx "@escaped_email:k\\.brown\\@example\\.com"
```

```
HMSET ru203:user:details:1000 first_name "Andrew" last_name "Brookins" escaped_email "a\\.m\\.brookins\\@example\\.com" user_id "1000"

FT.SEARCH users-idx "@escaped_email:a\\.m\\.brookins\\@example\\.com"
```

#### Handling Spelling Errors ï¼ˆå¤„ç†æ‹¼å†™é”™è¯¯ï¼‰

> å¦‚æœç¬¬ä¸€æ¬¡æœç´¢ç»“æœæ˜¯ `0`ï¼Œå¯ä»¥å°è¯• `FT.SPELLCHECK` å¯¹æœç´¢å…³é”®è¯åšæ‹¼å†™æ£€æŸ¥

```
FT.SPELLCHECK books-idx wizrds
```

```
FT.SPELLCHECK books-idx monter

FT.SEARCH books-idx "%monter%"
```


### Data Model

```
    Authors
+--------------+
|  name        |               Author-Books
|              |            +----------------+
|  author_id   +------------+  author_id     |
|              |            |                |
+--------------+        +---+  book_isbn     |
                        |   |                |
    Users               |   +----------------+
+--------------+        |
|  first_name  |        |
|              |        |
|  last_name   |        |       Checkouts
|              |        |  +------------------------+
|  email       |   +----|--+  user_id               |
|              |   |    |  |                        |
|  user_id     +---+    +--+  book_isbn             |
|              |        |  |                        |
|  last_login  |        |  |  checkout_date         |
|              |        |  |                        |
+--------------+        |  |  checkout_length_days  |
                        |  |                        |
    Books               |  |  geopoint              |
+--------------+        |  |                        |
|  isbn        +--------+  +------------------------+
|              |
|  title       |
|              |
|  subtitle    |
|              |
|  thumbnail   |
|              |
|  description |
|              |
|  categories  |
|              |
|  authors     |
|              |
|  author_ids  |
|              |
+--------------+
```
