# ç‡•å±±é¡¹ç›®æ—¥å¿—

## 20210303

### çŠ¶å†µ

#### æµ‹è¯•ç¯å¢ƒ

IP: 101....142
Docker Compose
registry.cn-hangzhou.aliyuncs.com/arguss/frontend:0.0.1-argus-yanshan
registry.cn-hangzhou.aliyuncs.com/arguss/service:0.0.1-argus-yanshan
redis:5.0.7-alpine
postgres:12.1-alpine

#### æ„å»ºæ—¶é—´

http://www.argus.weready.online
6 weeks ago ( ~ 2021.1 ä¸­ä¸‹æ—¬ )

#### æµ‹è¯•ç¯å¢ƒåŸŸåé…ç½®ï¼ˆå•æœºï¼‰

http://www.argus.weready.online/
101.xx.xxx.142

#### æµ‹è¯•ç¯å¢ƒåŸŸåé…ç½®ï¼ˆé›†ç¾¤ï¼‰

http://www.argus.weready.online/
118.xx.xxx.130

#### æ­£å¼ç¯å¢ƒåŸŸåé…ç½®

http://www.yanshan.weready.online:30080/
111.xxx.xxx.182

- projects ä¸‹é¢çš„å­ç›®å½•

`yanshan.0.5.9` ~ `yanshan.0.5.15` ä»¥åŠ `yanshan`

### è®¡åˆ’

#### æ‘¸åº•å½“å‰ä»£ç æƒ…å†µ ğŸ‘Œ 

- [x] æœ¬åœ°æ„å»º
- [x] æœ¬åœ°è¿è¡Œ

#### æ›´æ–°é•œåƒç‰ˆæœ¬å·ï¼Œæ„å»ºæ—¶é—´ç­‰æ„å»ºä¿¡æ¯ ğŸ‘Œ 

#### æµ‹è¯•ç¯å¢ƒæ•°æ®è¿ç§»è‡³æœ¬åœ°ç¯å¢ƒ ğŸ‘Œ 

```
docker exec -it dbpg /bin/bash
pg_dump -h dbpg -U postgres argus > ./backup.bak

sz backup.bak
```

#### é•œåƒæ¨é€åˆ°é•œåƒåº“ ğŸ‘Œ 

```
sh dockerpush.sh
```

#### k8s æµ‹è¯•ç¯å¢ƒè¯•è¿è¡Œ ğŸ‘Œ 

```
sh argus.clone.sh
sh dockerpull.sh
sh start.sh
```

#### k8s æµ‹è¯•ç¯å¢ƒæ•°æ®å¯¼å…¥ ğŸ‘Œ 

```
rz

psql -d argus -U postgres
\i clear_all.sql;
\i pg_dump_xxxxxxx.sql;
```

#### k8s Ingress é…ç½® ï¼ˆ30080 ç«¯å£è®¿é—®ï¼‰ğŸ‘Œ 

```
kubectl delete -f traefik-ds-http-30080.yaml
kubectl apply -f traefik-ds-http-30080.yaml
```

#### åŠŸèƒ½æµ‹è¯• ğŸ‘Œ 

- [x] ç”¨æˆ·æ–‡ä»¶ä¸Šä¼ ä¸‹è½½

#### åœæ­¢å½“å‰ç³»ç»Ÿè¿è¡Œ

- è¿›å…¥ k8s-w1

```
cd ~/projects/yanshan/tools/ops
sh stop.sh
```

#### ä¿å­˜å½“å‰ç³»ç»Ÿ

`yanshan` é‡å‘½å `yanshan.0.5.15.latest.runtime`

#### ä¸‹è½½æœ€æ–°çš„ä»£ç 

```
vi argus.clone.sh
sh argus.clone.sh
mv argus.new argus
```

#### æ‹‰å–é•œåƒ

```
cd argus/tools/ops/yanshan.k8s
sh dockerpull.sh
```

#### å¯åŠ¨ç³»ç»Ÿ

```
sh start.sh
```

#### æµ‹è¯•

#### å¯¼å…¥æ•°æ®åº“
